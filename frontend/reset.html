<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8" />
  <title>Zylo | Reset Password</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <link rel="icon" href="/images/Zylo_icon.ico" type="image/x-icon" />
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="/files/style.css">
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          animation: {
            fadeIn: 'fadeIn 0.6s ease-out',
          },
          keyframes: {
            fadeIn: {
              '0%': { opacity: '0', transform: 'translateY(15px)' },
              '100%': { opacity: '1', transform: 'translateY(0)' }
            }
          }
        }
      }
    };
  </script>
</head>

<body class="min-h-screen flex items-center justify-center px-4 transition-colors duration-500">
  <div class="w-full max-w-sm bg-white/20 backdrop-blur-md dark:bg-gray-800/30 border border-white/10 rounded-xl shadow-2xl p-6 space-y-4 animate-fadeIn">

    <h2 class="text-2xl font-bold text-center text-gray-800 dark:text-white">Reset Your Password</h2>
    <p class="text-sm text-gray-700 dark:text-gray-300">Enter your new password.</p>

    <input id="resetUser" type="text" placeholder="Username"
      class="w-full px-4 py-2 rounded-lg border dark:border-gray-600 bg-white/80 dark:bg-gray-700 text-gray-800 dark:text-white placeholder-gray-500 dark:placeholder-gray-400" />

    <div class="relative">
      <input id="newPassword" type="password" placeholder="New Password"
        class="w-full px-4 py-2 pr-10 rounded-lg border dark:border-gray-600 bg-white/80 dark:bg-gray-700 text-gray-800 dark:text-white placeholder-gray-500 dark:placeholder-gray-400" />
      <span onclick="togglePassword('newPassword', this)" class="absolute top-2.5 right-3 text-green-600 dark:text-green-400 cursor-pointer text-sm">üëÅÔ∏è</span>
    </div>

    <div class="relative">
      <input id="confirmNewPassword" type="password" placeholder="Confirm Password"
        class="w-full px-4 py-2 pr-10 rounded-lg border dark:border-gray-600 bg-white/80 dark:bg-gray-700 text-gray-800 dark:text-white placeholder-gray-500 dark:placeholder-gray-400" />
      <span onclick="togglePassword('confirmNewPassword', this)" class="absolute top-2.5 right-3 text-green-600 dark:text-green-400 cursor-pointer text-sm">üëÅÔ∏è</span>
    </div>

    <button onclick="submitReset()"
      class="w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-2 rounded-lg transition duration-200">
      Submit
    </button>

    <p id="resetResult" class="text-sm text-center hidden"></p>
  </div>

  <script>
    window.onload = () => {
      const params = new URLSearchParams(window.location.search);
      const user = params.get("user");
      if (user) document.getElementById("resetUser").value = user;
    };

    function togglePassword(id, el) {
      const input = document.getElementById(id);
      if (input.type === "password") {
        input.type = "text";
        el.textContent = "üôà";
      } else {
        input.type = "password";
        el.textContent = "üëÅÔ∏è";
      }
    }

    async function submitReset() {
      const username = document.getElementById("resetUser").value;
      const newPassword = document.getElementById("newPassword").value;
      const confirm = document.getElementById("confirmNewPassword").value;
      const result = document.getElementById("resetResult");
      const baseUrl = `${window.location.protocol}//${window.location.hostname}:5000`;

      if (!username || !newPassword || !confirm) {
        result.textContent = "Please fill out all fields.";
        result.classList.remove("hidden", "text-green-600");
        result.classList.add("text-red-600");
        return;
      }

      if (newPassword !== confirm) {
        result.textContent = "Passwords do not match.";
        result.classList.remove("hidden", "text-green-600");
        result.classList.add("text-red-600");
        return;
      }

      const res = await fetch(`${baseUrl}/api/reset`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ username, newPassword })
      });

      const data = await res.json();
      result.textContent = data.success ? "Password updated successfully!" : (data.error || "Reset failed.");
      result.classList.remove("hidden", "text-red-600", "text-green-600");
      result.classList.add(data.success ? "text-green-600" : "text-red-600");
    }
  </script>
</body>
</html>